# Biblical Time Machine - Open-Ended Edition
# Tell the machine WHO you want to meet or WHEN you want to go
# The AI dynamically determines the time period, location, and context

default_max_attempts_per_step: 5
classifier_model: "MODEL_1"
feedback_model: "MODEL_1"

tokens_for_ai_rubric: |
  You are an intelligent Biblical time machine AI assistant.

  Your job is to facilitate open-ended time travel through Biblical history.

  KEY BEHAVIORS:
  - When user names a person (Moses, David, Jesus, etc.), determine when they lived and teleport there
  - When user names a date/era (30 AD, Garden of Eden, etc.), determine context and teleport there
  - When user names an event (Exodus, Crucifixion, etc.), teleport to that event
  - Be flexible and adaptive - support ANY biblical request
  - Provide brief, dynamic briefings based on their choice
  - Emphasize location accuracy (NO Temple in Genesis/Exodus, FIRST Temple with Solomon, SECOND Temple with Jesus, NO Temple after 70 AD)

  CRITICAL: Maintain biblical and historical accuracy at all times.

sections:
  # ============================================================================
  # INTRODUCTION
  # ============================================================================
  - section_id: "introduction"
    title: "Biblical Time Machine"
    steps:
      - step_id: "welcome"
        title: "Welcome"
        content_blocks:
          - "# ⏳ Biblical Time Machine ⏳"
          - ""
          - "You have discovered a time machine that can transport you to ANY moment in Biblical history."
          - ""
          - "**Tell me:**"
          - "- WHO you want to meet (Moses, Jesus, David, etc.)"
          - "- WHEN you want to go (30 AD, Garden of Eden, Exodus, etc.)"
          - "- WHAT event you want to witness (Red Sea crossing, Pentecost, etc.)"
          - ""
          - "The machine will calculate the correct time period and take you there."

      - step_id: "language"
        title: "Language"
        question: "What language would you like to use? (English, Spanish, French, etc.)"
        tokens_for_ai: |
          User selecting language.

          Categorize as 'set' for any language.
          Categorize as 'skip' if they want English or to skip.
        buckets: [set, skip]
        transitions:
          set:
            metadata_add:
              language: "the-users-response"
            next_section_and_step: "time_machine:destination_input"
          skip:
            metadata_add:
              language: "English"
            next_section_and_step: "time_machine:destination_input"

  # ============================================================================
  # TIME MACHINE - OPEN-ENDED DESTINATION
  # ============================================================================
  - section_id: "time_machine"
    title: "Time Machine"
    steps:
      - step_id: "destination_input"
        title: "Where/When/Who"
        question: "Where would you like to go, who would you like to meet, or when would you like to visit? (Or type 'END' to finish)"
        tokens_for_ai: |
          This is COMPLETELY OPEN-ENDED. User can request:
          - A person: "Moses", "Jesus", "David", "Paul", "Adam", etc.
          - A time: "30 AD", "Garden of Eden", "Exodus era", etc.
          - An event: "Red Sea crossing", "Pentecost", "Crucifixion", etc.
          - A place: "Jerusalem", "Egypt", "Rome", etc.

          Your job: Determine what biblical era they're requesting.

          Categorize as:
          - 'garden_eden' if Garden of Eden, Paradise, Adam/Eve before Fall, beginning, creation
          - 'early_world' if Cain, Abel, Enoch, Noah, Flood, post-Fall pre-Abraham
          - 'patriarchs' if Abraham, Isaac, Jacob, Joseph, patriarchs era
          - 'egypt_moses' if Moses, Exodus, Egypt, Pharaoh, plagues, Red Sea, Passover, ~1446 BC
          - 'wilderness_judges' if Joshua, Judges, Deborah, Gideon, Samson, conquest of Canaan
          - 'kingdom' if Saul, David, Solomon, kings, united/divided kingdom, ~1000-586 BC
          - 'exile_prophets' if Babylon, Daniel, Ezekiel, Jeremiah, Isaiah, exile, prophets
          - 'jesus' if Jesus, Christ, Messiah, Galilee, 30 AD, ministry, disciples
          - 'crucifixion_resurrection' if cross, crucifixion, resurrection, Easter, Golgotha
          - 'early_church' if Pentecost, Acts, apostles, Peter/John after Jesus
          - 'paul' if Paul, missionary journeys, letters, epistles, church planting
          - 'persecution' if persecution, martyrs, Rome, catacombs, Nero, 64-313 AD
          - 'end' if END, finish, done, quit
          - 'unclear' if you can't determine what they mean
        buckets: [garden_eden, early_world, patriarchs, egypt_moses, wilderness_judges, kingdom, exile_prophets, jesus, crucifixion_resurrection, early_church, paul, persecution, end, unclear]
        transitions:
          garden_eden:
            ai_feedback:
              tokens_for_ai: |
                User wants to go to Garden of Eden / meet Adam & Eve.

                Provide a BRIEF departure briefing:
                - Destination: Garden of Eden, east of Mesopotamia
                - Time: Before the Fall, ~4000 BC
                - Context: Paradise before sin. No buildings, Temple, or cities. Perfect nature. Tree of Life. God walks with Adam & Eve.
                - Who's there: Adam, Eve, God, animals

                End with: "⚡ Time travel initiated!"

                Use their language from metadata.language.
            metadata_add:
              current_era: "Garden of Eden"
              current_date: "~4000 BC (Pre-Fall)"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          early_world:
            ai_feedback:
              tokens_for_ai: |
                User wants early world (Cain/Abel/Noah/Flood era).

                Brief briefing:
                - Destination: Post-Fall world or Noah's time
                - Time: ~4000-2350 BC
                - Context: Sin has entered. Cain murdered Abel. Enoch walked with God. Noah building ark. No cities yet. First altars.
                - Who's there: Adam/Eve (fallen), Cain, Abel, Seth, Enoch, Noah, Noah's family

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Early World"
              current_date: "~4000-2350 BC"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          patriarchs:
            ai_feedback:
              tokens_for_ai: |
                User wants patriarchs era (Abraham/Isaac/Jacob/Joseph).

                Brief briefing:
                - Destination: Canaan / Egypt
                - Time: ~2000-1800 BC
                - Context: God's covenant with Abraham. Isaac, Jacob, Joseph. NO Temple yet—only altars. Joseph in Egypt.
                - Who's there: Abraham, Sarah, Isaac, Rebekah, Jacob, Rachel, Joseph, etc.

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Patriarchs"
              current_date: "~2000-1800 BC"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          egypt_moses:
            ai_feedback:
              tokens_for_ai: |
                User wants Moses/Exodus era.

                Brief briefing:
                - Destination: Egypt, near Nile River
                - Time: ~1446 BC
                - Context: Hebrew slaves. Moses confronting Pharaoh. Plagues. Passover coming. NO Temple yet (won't exist for 500+ years). Moses uses simple altars.
                - Who's there: Moses, Aaron, Miriam, Pharaoh, Hebrew slaves, Egyptians

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Egypt & Exodus"
              current_date: "~1446 BC"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          wilderness_judges:
            ai_feedback:
              tokens_for_ai: |
                User wants wilderness/Joshua/Judges era.

                Brief briefing:
                - Destination: Canaan / Israel
                - Time: ~1400-1050 BC
                - Context: Conquest of Canaan. Judges leading. Tabernacle at Shiloh. NO Temple yet. Cycle of sin and deliverance.
                - Who's there: Joshua, Caleb, Deborah, Gideon, Samson, Ruth, etc.

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Judges Era"
              current_date: "~1400-1050 BC"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          kingdom:
            ai_feedback:
              tokens_for_ai: |
                User wants kingdom era (Saul/David/Solomon/kings).

                Brief briefing:
                - Destination: Jerusalem / Israel
                - Time: ~1000-586 BC
                - Context: Determine from their request if it's David's time (NO Temple yet, just Tabernacle/Ark) or Solomon's time (FIRST TEMPLE!) or divided kingdom.
                - Who's there: Depends on specific period—Saul, David, Solomon, kings, prophets
                - CRITICAL: Temple only exists from Solomon onward (~970 BC)

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Kingdom Period"
              current_date: "~1000-586 BC"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          exile_prophets:
            ai_feedback:
              tokens_for_ai: |
                User wants exile/prophets era.

                Brief briefing:
                - Destination: Babylon / ruins of Jerusalem
                - Time: ~586-538 BC
                - Context: Temple destroyed (586 BC). Jews exiled to Babylon. Daniel, Ezekiel there. Prophets speaking God's word.
                - Who's there: Daniel, Ezekiel, Jeremiah (Jerusalem), exiled Jews

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Exile & Prophets"
              current_date: "~586-538 BC"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          jesus:
            ai_feedback:
              tokens_for_ai: |
                User wants Jesus' ministry.

                Brief briefing:
                - Destination: Galilee / Judea
                - Time: ~27-30 AD
                - Context: Jesus teaching, healing, performing miracles. SECOND Temple (Herod's) stands in Jerusalem. Roman occupation.
                - Who's there: Jesus, disciples, Mary Magdalene, crowds, Pharisees, etc.

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Jesus' Ministry"
              current_date: "~27-30 AD"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          crucifixion_resurrection:
            ai_feedback:
              tokens_for_ai: |
                User wants crucifixion/resurrection.

                Brief briefing:
                - Destination: Jerusalem, Golgotha / Garden Tomb
                - Time: Passover ~30 AD
                - Context: Jesus' final week. Crucifixion on Friday. Resurrection on Sunday. SECOND Temple still stands.
                - Who's there: Jesus, disciples, Mary Magdalene, Roman soldiers, crowd

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Crucifixion & Resurrection"
              current_date: "~30 AD (Passover)"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          early_church:
            ai_feedback:
              tokens_for_ai: |
                User wants early church/Pentecost.

                Brief briefing:
                - Destination: Jerusalem
                - Time: ~33-60 AD
                - Context: Pentecost. Holy Spirit poured out. Church born. Apostles preaching. SECOND Temple still stands (until 70 AD).
                - Who's there: Peter, John, apostles, new believers, Jewish authorities

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Early Church"
              current_date: "~33-60 AD"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          paul:
            ai_feedback:
              tokens_for_ai: |
                User wants Paul's missionary journeys.

                Brief briefing:
                - Destination: Various cities (Antioch, Ephesus, Corinth, Rome, etc.)
                - Time: ~46-67 AD
                - Context: Paul planting churches, writing letters. Temple exists until 70 AD. Persecution beginning.
                - Who's there: Paul, Barnabas, Timothy, Silas, church members

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Paul's Missions"
              current_date: "~46-67 AD"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          persecution:
            ai_feedback:
              tokens_for_ai: |
                User wants persecution era.

                Brief briefing:
                - Destination: Rome, catacombs
                - Time: ~64-313 AD
                - Context: Nero's persecution. Temple destroyed 70 AD. Christians meeting in secret. Martyrs facing lions. Faith underground.
                - Who's there: Paul (imprisoned), Peter, martyrs, persecuted believers, church leaders

                End with: "⚡ Time travel initiated!"
            metadata_add:
              current_era: "Persecution"
              current_date: "~64-313 AD"
              epochs_visited: "n+1"
            next_section_and_step: "exploration:who_to_meet"

          end:
            next_section_and_step: "conclusion:reflection"

          unclear:
            content_blocks:
              - "I'm not sure what time period you're requesting. Can you be more specific?"
              - "Examples: 'Moses', '30 AD', 'Garden of Eden', 'Exodus', 'Jesus', 'David', etc."
            counts_as_attempt: false
            next_section_and_step: "time_machine:destination_input"

  # ============================================================================
  # EXPLORATION - OPEN-ENDED NPC INTERACTION
  # ============================================================================
  - section_id: "exploration"
    title: "Exploration"
    steps:
      - step_id: "who_to_meet"
        title: "Who to Meet"
        question: "Who would you like to meet in this time period? (Or 'LEAVE' to go somewhere else, 'NEW TIME' for different era)"
        tokens_for_ai: |
          User is choosing who to meet in their current era (metadata.current_era).

          This is COMPLETELY OPEN-ENDED. They can name:
          - Specific person from that era
          - Type of person (slave, priest, soldier, etc.)
          - Multiple people

          Categorize as:
          - 'meet_someone' if they name a specific person or type
          - 'leave' if LEAVE, go back, return
          - 'new_time' if they want different era
          - 'explore' if they want to look around first
        buckets: [meet_someone, leave, new_time, explore]
        transitions:
          meet_someone:
            ai_feedback:
              tokens_for_ai: |
                User wants to meet someone in metadata.current_era (metadata.current_date).

                Their request: the-users-response

                Your job:
                1. Determine if that person/type exists in this era
                2. If yes: Describe meeting them (brief - 2-3 sentences)
                3. If no: Politely explain they aren't in this era

                Use metadata.language for response.

                Be historically accurate about locations (Temple status, cities, etc.).
            metadata_add:
              current_npc: "the-users-response"
              people_met: "n+1"
            next_section_and_step: "exploration:conversation"

          leave:
            next_section_and_step: "time_machine:destination_input"

          new_time:
            next_section_and_step: "time_machine:destination_input"

          explore:
            ai_feedback:
              tokens_for_ai: |
                User wants to explore/look around in metadata.current_era (metadata.current_date).

                Describe what they see (brief - 3-4 sentences):
                - Geography/location
                - Buildings (or lack thereof - NO Temple in early eras!)
                - Activity happening
                - People present

                End by asking who they'd like to meet.

                Use metadata.language.
            counts_as_attempt: false
            next_section_and_step: "exploration:who_to_meet"

      - step_id: "conversation"
        title: "Conversation"
        question: "What would you like to say or ask?"
        tokens_for_ai: |
          User conversing with metadata.current_npc in metadata.current_era (metadata.current_date).

          Categorize as:
          - 'theological' for deep questions about God, faith, theology
          - 'historical' for questions about events, history, context
          - 'personal' for questions about the NPC's life and experience
          - 'continue' for statements or comments
          - 'done' if goodbye, done talking, want to leave
          - 'someone_else' if they want to meet someone else
          - 'new_time' if they want to go to different era
          - 'language_change' for language change
        buckets: [theological, historical, personal, continue, done, someone_else, new_time, language_change]
        transitions:
          theological:
            ai_feedback:
              tokens_for_ai: |
                Respond IN CHARACTER as metadata.current_npc.

                Context:
                - Era: metadata.current_era
                - Date: metadata.current_date
                - Language: metadata.language

                Answer their theological question with biblical accuracy.
                Reference scripture if relevant.
                Show the NPC's faith and perspective.
                Be historically accurate about locations (Temple, buildings, etc.).

                Keep response conversational (not essay-length).
            next_section_and_step: "exploration:conversation"

          historical:
            ai_feedback:
              tokens_for_ai: |
                Respond IN CHARACTER as metadata.current_npc.

                Answer their historical question accurately.
                Provide context about events, locations, daily life.
                Be accurate about buildings, Temple status, geography.

                Use metadata.language.
            next_section_and_step: "exploration:conversation"

          personal:
            ai_feedback:
              tokens_for_ai: |
                Respond IN CHARACTER as metadata.current_npc.

                Share personal experience, feelings, testimony.
                Be authentic to the time period and person's situation.

                Use metadata.language.
            next_section_and_step: "exploration:conversation"

          continue:
            ai_feedback:
              tokens_for_ai: |
                Respond IN CHARACTER as metadata.current_npc.

                Respond naturally to their statement.
                Continue the conversation.

                Use metadata.language.
            next_section_and_step: "exploration:conversation"

          done:
            ai_feedback:
              tokens_for_ai: |
                The NPC bids them farewell (brief - 1-2 sentences).

                Use metadata.language.
            next_section_and_step: "exploration:who_to_meet"

          someone_else:
            content_blocks:
              - "Ending current conversation..."
            next_section_and_step: "exploration:who_to_meet"

          new_time:
            content_blocks:
              - "Returning to time machine..."
            next_section_and_step: "time_machine:destination_input"

          language_change:
            metadata_add:
              language: "the-users-response"
            content_blocks:
              - "Language updated."
            counts_as_attempt: false
            next_section_and_step: "exploration:conversation"

  # ============================================================================
  # CONCLUSION
  # ============================================================================
  - section_id: "conclusion"
    title: "Journey's End"
    steps:
      - step_id: "reflection"
        title: "Reflection"
        question: "What was the most meaningful moment from your journey through Biblical history?"
        tokens_for_ai: |
          User reflecting on their experience.

          Categorize as 'reflect' for any response.
        feedback_tokens_for_ai: |
          Respond to their reflection with encouragement.

          - Acknowledge what they found meaningful
          - Connect to biblical themes
          - Encourage further Bible study
          - Thank them for the journey

          Use metadata.language.

          End with blessing and invitation to return.
        buckets: [reflect]
        transitions:
          reflect:
            ai_feedback:
              tokens_for_ai: "Provide warm, encouraging response about their spiritual journey."
            metadata_add:
              activity_completed: "true"
            next_section_and_step: "conclusion:goodbye"

      - step_id: "goodbye"
        title: "Farewell"
        content_blocks:
          - "# Thank You for Traveling Through Biblical History"
          - ""
          - "From Eden to persecution, from Paradise to martyrdom—"
          - "you've witnessed God's redemptive story unfold."
          - ""
          - "The time machine is always here when you want to return. ⏳"
